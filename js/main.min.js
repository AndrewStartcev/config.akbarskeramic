import{updateWallTexture}from"./model.js";$(document).ready(function(){}),$(document).ready(function(){function e(){$("#canvas").attr("width",$("#AKBARS").width()+"px"),$("#canvas").attr("height",$("#AKBARS").height()+"px")}function t(){$("#canvas").width()<=600?(X=40,Y=40,z=$("#AKBARS").width()/5,G=z*D):$("#canvas").width()<=1920?(X=70,Y=80,z=$("#AKBARS").width()/20,G=z*D):(X=110,Y=100,z=$("#AKBARS").width()/20,G=z*D)}function a(e){for(var t,a,i=e.length;0!==i;)a=Math.floor(Math.random()*i),i-=1,t=e[i],e[i]=e[a],e[a]=t;return e}function i(){q=[],$("#chosen-bricks .chosen-brick.active").each(function(){let e=new Image;e.onload=s,e.src=$(this).find("img").attr("src");let t=parseInt($(this).find(".percent-line").val());for(let a=0;a<t;a++)q.push(e)}),n()}function n(){q=a(q)}function s(){c()}function o(){q=[];let e=new Image,t=100;e.onload=s,e.src="bricks/bricks/"+$(".brick-item.active").data("value")+".png";for(let a=0;a<t;a++)q.push(e);n(),g(),f(),k(),r("spoon",2),updateWallTexture()}function c(){switch(g(),f(),k(),M){case"spoon":r("spoon",2);break;case"spoon1":r("spoon1",4);break;case"spoon2":r("spoon2",4);break;case"chain":d(4);break;case"chaotic":p(4)}m(),updateWallTexture()}function r(e,t){for(j=0;j<X;j++)for(H=$.inArray(e,["spoon","spoon1"])>-1?j%2==0?0:-1*z/t:j*(-1*z/t),T=0;T<Y;T++)n(),h(),l()}function h(){U.save();const e=T*z+T*y+H,t=j*G+j*y,a=U.createLinearGradient(e+z,t,e,t);a.addColorStop(0,"rgba(0, 0, 0, 0.1)"),a.addColorStop(1,"rgba(0, 0, 0, 0)"),U.fillStyle=a,U.globalCompositeOperation="source-atop",U.drawImage(q[T],e,t,z,G),U.fillRect(e,t,z,G),U.restore()}function l(){U.shadowColor="rgba(0, 0, 0, 0.7)",U.shadowBlur=4,U.shadowOffsetX=2,U.shadowOffsetY=2}function d(e){for(j=0;j<X;j++)for(H=j%2==0?0:-1*z/e-z,T=0;T<Y;T++)T%3==0?2:1,T%3==1&&Math.round(T/3)*z/2,n(),h(),l()}function p(e){var t=0;for(j=0;j<X;j++)for(H=j%2==0?0:-1*z/e-z,0,T=0;T<Y;T++)n(),t=Math.floor(2*Math.random()+1),h(),2==t&&z/2,l()}function v(e,t){1==$("#"+e).hasClass("active")?($("#app-menu").removeClass(t),$(".app-chapter-dop").removeClass("active")):($("#app-menu").addClass(t),$(".app-chapter-dop").removeClass("active"),$("#"+e).addClass("active"))}function u(e,t){$("#app-menu").removeClass("opened-dop"),1==$("#"+e).hasClass("active")?($("#app-menu").removeClass(t),$(".app-chapter").removeClass("active")):($("#app-menu").addClass(t),$(".app-chapter").removeClass("active"),$("#"+e).addClass("active"))}function m(){w();const e=L,t=A(e,"image/jpeg"),a=new FileReader;a.onloadend=function(){const e=a.result;$(".house .face-textures").css("background-image","url('"+e+"')")},a.readAsDataURL(t)}function f(){y=$(".group-items.seam .group-item.active").data("value"),W=$(".group-items.seam-color .group-item.active").index(),M=$(".group-items.bricklaying .group-item.active").data("value"),D=$(".group-items.format .group-item.active").data("value"),G=z*D}function g(){U.clearRect(0,0,O.width,O.height)}function b(){$(".group-items.seam-color .group-item").each(function(){var e=$(this).data("value");let t=new Image;t.onload=C,t.src=I+e+".jpg",F.push(t)})}function k(){for(let e=0;e<O.width;e+=512)for(let t=0;t<O.height;t+=512)U.drawImage(F[W],e,t)}function C(){}function w(){L=O.toDataURL();let e=new Image;e.width=O.width,e.height=O.height,e.src=L}function A(e,t){const a=512,i=atob(e.split(",")[1]),n=[];for(let e=0;e<i.length;e+=a){const t=i.slice(e,e+a),s=new Array(t.length);for(let e=0;e<t.length;e++)s[e]=t.charCodeAt(e);const o=new Uint8Array(s);n.push(o)}const s=new Blob(n,{type:t});return s}function R(){var e=$("#chosen-bricks .chosen-brick.active").length,t=0,a=!0;switch(e){case 1:t=100,a=!0;break;case 2:t=50,a=!1;break;case 3:t=34,a=!1;break;case 4:t=25,a=!1;break;case 5:t=20,a=!1}$("#chosen-bricks .chosen-brick.active .percentage .percent-line").val(t).attr("disabled",a),$("#chosen-bricks .chosen-brick.active .percentage span").html(Math.round(100/e,2))}function S(){$("#chosen-bricks .chosen-brick.active .percent-line").each(function(){var e=$(this).val();$(this).closest(".chosen-brick.active").find("span").html(e)})}function B(){var e=0;$(".percent-line").each(function(){e+=parseInt($(this).val(),10)});var t=100-e;$(".percent-line").each(function(){var e=parseInt($(this).val(),10)+t/$(".percent-line").length;$(this).val(e.toFixed(2))}),K()}function K(){var e=0,t=-1e3,a=0;$(".percent-line").each(function(){$(this).val()>t&&(t=$(this).val(),a=$(this).closest(".chosen-brick").index()),e+=parseInt($(this).val())});var i=100-e,n=$(".chosen-brick").eq(a).find(".percent-line");n.val(parseInt(n.val())+i)}function x(){var e,t,a=$(".container-3d"),i=$(window),n=1.7778;i.innerWidth()>=i.innerHeight()?parseInt(i.innerHeight()*n)<=i.innerWidth()?(e=parseInt(i.innerHeight()*n),t=i.innerHeight()):(e=i.innerWidth(),t=e/n):parseInt(i.innerWidth()*n)<=i.innerWidth()?(e=parseInt(i.innerWidth()*n),t=i.innerWidth()):(e=i.innerWidth(),t=e/n),a.css("height",t+"px").css("width",e+"px")}window.site="",window.versio="v1.0",$("#canvas").width=window.width,$("#canvas").height=window.height;var I=site+"seams/";let y,W,M,H,T,j,L,O=$("#canvas").get(0),U=O.getContext("2d"),D=$(".group-items.format .group-item.active").data("value"),F=[],q=[],z=$("#AKBARS").width()/20,G=z*D,X=50,Y=60;e(),t(),updateWallTexture(),$(window).resize(function(){e(),x(),t(),c()}),$("#AKBARS").on("click",".tab-menu",function(){$(this).hasClass("chosen")?$(this).removeClass("chosen"):($(".app-menu-item").removeClass("chosen"),$(this).addClass("chosen")),u($(this).data("chapter"),"opened")}),$("#AKBARS").on("click",".tab-menu-dop",function(){$(this).hasClass("active")?$(this).removeClass("active"):($(".tab-menu-dop").removeClass("active"),$(this).addClass("active")),v($(this).data("chapter"),"opened-dop")}),$("#AKBARS").on("click",".group-item",function(){$(this).closest(".group-items").data("settings"),$(this).data("value");$(this).closest(".group-items").find(".group-item").removeClass("active"),$(this).addClass("active"),c()}),$("#AKBARS").on("click","#mode-2d",function(){$(this).addClass("active"),$("#mode-3d").removeClass("active"),$("#mode-3d-three").removeClass("active"),$("#house").hide(),$("#layout-3d-three").hide()}),$("#AKBARS").on("click","#mode-3d",function(){$(this).addClass("active"),$("#mode-2d").removeClass("active"),$("#mode-3d-three").removeClass("active"),$("#house").show(),$("#layout-3d-three").hide()}),$("#AKBARS").on("click","#mode-3d-three",function(){$(this).addClass("active"),$("#layout-3d-three").show(),$("#mode-2d").removeClass("active"),$("#mode-3d").removeClass("active"),$("#house").hide()}),$("#AKBARS").on("click","#canvas, #house",function(){$("#app-menu").removeClass("opened"),$(".app-chapter").removeClass("active"),$(".app-menu-item").removeClass("chosen")}),f(),b(),$("#AKBARS").on("click",".brick-item",function(){var e="bricks/bricks/"+$(this).data("value")+".png",t=$(this).find("h2").html();5==$("#chosen-bricks .chosen-brick.active").length||(1==$("#chosen-bricks .no-bricks").length&&$("#chosen-bricks .no-bricks").remove(),$(this).hide(),$("#chosen-bricks").append('<div class="chosen-brick active" data-preview="bricks/preview/'+$(this).data("value")+'.png"><img src="'+e+'"><div class="info"><div class="title"><h2>'+t+'</h2><i class="fa fa-times" data-brick="'+$(this).data("value")+'"></i></div><div class="percentage"><input class="percent-line" type="range" min="0" value="0" max="100" step="1" list="values"><b><span></span>%</b></div></div></div>'),R(),i(),c())}),$("#AKBARS").on("click",".chosen-brick.active i.fa-times",function(){var e=$(this).data("brick");$(this).closest(".chosen-brick").remove(),$(".brick-item."+e).show(),0==$("#chosen-bricks .chosen-brick").length?$("#chosen-bricks").html('<div class="no-bricks flex-center">Выберите кладку кирпичей</div>'):(R(),i(),c())}),$("#AKBARS").on("input",".chosen-brick.active .percent-line",function(){B(),S(),i(),c()}),x(),o()}),$("#layout-3d-three").on("click",function(e){$(e.target).closest("#app-menu").length||($(".app-menu-item").removeClass("chosen"),$(".tab-menu-dop").removeClass("active"),$(".app-chapter").removeClass("active"),$("#app-menu").removeClass("opened"),$("#app-menu").removeClass("opened-dop"))}),$("#AKBARS").on("click",".close-button",function(){$(".app-menu-item").removeClass("chosen"),$(".tab-menu-dop").removeClass("active"),$(".app-chapter").removeClass("active"),$("#app-menu").removeClass("opened"),$("#app-menu").removeClass("opened-dop")});